# Helm Charts Repository

Personal Helm chart repository published as GitHub Pages at `https://moreirodamian.github.io/helm-charts/`.

## Repository structure

```
charts/                        # All charts live here
  cert-manager/                # cert-manager v1.19.3 wrapper with custom issuers
  cert-manager-issuer/         # ClusterIssuers (Let's Encrypt: HTTP-01, DNS-01 DO/Cloudflare)
  eks-boostraping/             # EKS cluster bootstrap via ArgoCD Applications
  generic-app/                 # Generic app chart (Argo Rollouts OR Deployment, HPA, PDB, NetworkPolicy, migrations, cron)
  k8s-do-boostraping/          # DigitalOcean cluster bootstrap via ArgoCD Applications
  laravel/                     # Multi-component Laravel (fpm, web-server, cron, queue)
    charts/fpm/
    charts/web-server/
    charts/cron/
    charts/queue/
  nginx-ingress/               # ingress-nginx 4.14.3 wrapper with metrics
  prometheus/                  # kube-prometheus-stack 82.0.0 with Grafana Cloud remote write
  prometheus-statsd-exporter/  # statsd-exporter 1.0.0 wrapper
  promtail/                    # Promtail 6.17.1 for shipping logs to Loki
  sealed-secret/               # Individual SealedSecret resource
  sealed-secrets/              # sealed-secrets controller 2.18.1 wrapper
index.yaml                     # Helm repo index (auto-generated by CI)
.github/workflows/release.yml  # CI: lint + chart-releaser-action v1.7.0
```

## Main charts

- **generic-app** (v1.0.0): Most versatile chart. Toggle between Argo Rollouts (canary) and standard Deployment via `rollout` value. Includes HPA, PDB, NetworkPolicy, SealedSecrets, migrations Job, CronJobs, custom services/ingress, Docker registry secrets, helm tests.
- **laravel**: Composed chart with subcharts (fpm, web-server, cron, queue). For Laravel apps with PHP-FPM + Nginx.
- **eks-boostraping / k8s-do-boostraping**: Cluster bootstrapping using ArgoCD Applications. Components deploy conditionally based on enabled flags and configuration availability.

## Common patterns

- **Sealed Secrets** for secure credential management.
- **ArgoCD** as the GitOps engine for bootstrapping charts.
- **Argo Rollouts** with canary deployments in generic-app.
- **Naming convention**: `{name}-{deployEnv}-{region}` for resources.
- **Global values**: namespace, image registry, appVersion shared between subcharts.
- Third-party dependencies reference official repos (jetstack, kubernetes, grafana, bitnami-labs, prometheus-community).

## CI/CD

- GitHub Actions with `helm/chart-releaser-action@v1.7.0` publishes charts on push to `main`.
- A `lint` job runs `helm lint` on all charts before release.
- `.tgz` packages are published as GitHub Releases.
- `index.yaml` at root is auto-updated.

## Development conventions

- Version charts in `Chart.yaml` on changes (SemVer).
- Templates follow standard Helm helpers (`_helpers.tpl`).
- Default values go in `values.yaml`; per-environment values go in separate files (`values-{env}.yaml`).
- Run `helm lint` and `helm template` to validate changes before committing.
- Do not commit `.tgz` or `Chart.lock` files (covered by `.gitignore`).
- All READMEs and documentation in English.
- generic-app uses `selector-labels` for selectors and `common-labels` for metadata labels.
- generic-app workload toggle: set `rollout` with canary config for Argo Rollouts, set `rollout: ~` for standard Deployment.
